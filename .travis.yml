sudo: required

services:
  - docker

env:
  - DOCKERFILE_DIR=python

- state: build docker image
  script:
    - cd $DOCKERFILE_DIR
    - docker build -t travis-ci-build-$DOCKERFILE_DIR .
    - docker images
    - docker tag travis-ci-build-$DOCKERFILE_DIR unittest/$DOCKERFILE_DIR
    - docker push unittest/$DOCKERFILE_DIR
- stage: test
  script: docker run --rm --cap-add SYS_ADMIN -v $PWD/unittest/$DOCKERFILE_DIR:/test --entrypoint "/test/unittest.sh" unittest/$DOCKERFILE_DIR

