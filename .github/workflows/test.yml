name: CI

on: [push, pull_request]

jobs:
  build1:
    name: build_group1
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node: 
          - dockerfile = ["cgit"]
          - dockerfile = ["clr-installer-ci"]
        
    steps:
    - uses: actions/checkout@v1
    - name: install
      run: | 
        sudo apt-get purge moby-engine moby-cli 
        sudo apt-get install docker.io bats -f
        sudo modprobe -r overlay
        sudo modprobe overlay redirect_dir=off
        sudo systemctl restart docker
    - name: run test
      run: |
        dir=$(pwd)
        cd ${{dockerfile}}
        docker build -t clearlinux/${{dockerfile}} .
        cd $dir
        if [ -d "./tests/${{dockerfile}}" ]; then cd tests; make ${{dockerfile}}; fi
